<!DOCTYPE html>

<meta charset="utf-8">
<style>

.bar {
  fill: steelblue;
}

.bar:hover {
  fill: brown;
}

.axis {
  font: 15px sans-serif;
}

.axis path,
.axis line {
  /*fill: none;*/
  fill: lightblue;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.axis path {
  display: none;
}

/* testing */
.grid .tick {
    /*stroke: lightgrey;*/
    stroke: lightblue;
    opacity: 0.9;
}
.grid path {
      stroke-width: 0;
}


/******************************************************/
/*tooltip*/


.bar:hover {
  fill: orangered ;
}

.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}
/* tooltip */
/******************************************************/

</style>
<label><input type="checkbox"> Sort by Value (otherwise Alphabetically) </label>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

<title> Homework 1 </title>

<h1><center> Homework 1 </center></h1>

<script>


var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

// var yAxis = d3.svg.axis()
//     .scale(y)
//     .orient("left")
//     .ticks(6);

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

/* returns the size/length of an object */
Object.size = function(obj) {
    var size = 0;
    for(key in obj) {
        if(obj.hasOwnProperty(key)) size++;
    }
    return size;
}

// start Grid
function make_x_axis() {        
    return d3.svg.axis()
        .scale(x)
         .orient("bottom")
         .ticks(5)
}
function make_y_axis() {        
    return d3.svg.axis()
        .scale(y)
        .orient("left")
        .ticks(5)
}
// end Grid

// create data
var myLetters = []

//initial vars
var letters = new Object;
var str2 = document.URL;
var str3 = decodeURI(str2)
console.log(str3)
var low = str3.toLowerCase();

// find where querystring begins
var n = low.search(/\?/);
var str = low.substring(n+2);

// strip special characters
// str = str.replace(/[^\w\s]/gi, '')
str = str.replace(/[^\w]/gi, '')

// print to console
console.log(str)

// count each letter in string, saving to object
for(x_var = 0, length = str.length; x_var < length; x_var++) {
    var l = str.charAt(x_var)
    letters[l] = (isNaN(letters[l]) ? 1 : letters[l] + 1);
}

var data = []

// output 
for(key in letters) {
    data.push({letter:key, frequency:letters[key]});
    // console.log({letter:key, frequency:letters[key]});
};
// console.log(data);
// console.log(letters);

////////////
// sort

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickSize(10)
    .tickPadding(10)
    .ticks(d3.max(data, function(d) { return d.frequency; }));


// tooltip
var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-10, 0])
  .html(function(d) {
    return "<strong>Frequency:</strong> <span style='color:red'>" + d.frequency + "</span>";
  });
// tooltip

// tooltip
svg.call(tip);
// tooltip

// d3.tsv("data.tsv", function(error, data) {

  data.forEach(function(d) {
    d.frequency = +d.frequency;
  });

  x.domain(data.map(function(d) { return d.letter; }));
  y.domain([0, d3.max(data, function(d) { return d.frequency; })]);

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end");
      // .text("Frequency");

  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return x(d.letter); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.frequency); })
      .attr("height", function(d) { return height - y(d.frequency); })
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide);

  d3.select("input").on("change", change);

  var sortTimeout = setTimeout(function() {
    d3.select("input").property("checked", true).each(change);
  }, 2000);

  function change() {
    clearTimeout(sortTimeout);

    // Copy-on-write since tweens are evaluated after a delay.
    var x0 = x.domain(data.sort(this.checked
        ? function(a, b) { return b.frequency - a.frequency; }
        : function(a, b) { return d3.ascending(a.letter, b.letter); })
        .map(function(d) { return d.letter; }))
        .copy();

    svg.selectAll(".bar")
        .sort(function(a, b) { return x0(a.letter) - x0(b.letter); });

    var transition = svg.transition().duration(750),
        delay = function(d, i) { return i * 50; };

    transition.selectAll(".bar")
        .delay(delay)
        .attr("x", function(d) { return x0(d.letter); });

    transition.select(".x.axis")
        .call(xAxis)
      .selectAll("g")
        .delay(delay);
  };
// });
///////////


// x.domain(data.map(function(d) { return d.letter; }));
// y.domain([0, d3.max(data, function(d) { return d.frequency; })]);


// moved yAxis var down here to change frequency to max value
// var yAxis = d3.svg.axis()
//     .scale(y)
//     .orient("left")
//     .tickSize(10)
//     .tickPadding(10)
//     .ticks(d3.max(data, function(d) { return d.frequency; }));

// svg.append("g")
//     .attr("class", "x axis")
//     .attr("transform", "translate(0," + height + ")")
//     .call(xAxis);

// svg.append("g")
//     .attr("class", "y axis")
//     .call(yAxis)
//   .append("text")
//     .attr("transform", "rotate(-90)")
//     .attr("y", 6)
//     .attr("dy", ".71em")
//     .style("text-anchor", "end");
//     // .text("Frequency");

// svg.selectAll(".bar")
//     .data(data)
//   .enter().append("rect")
//     .attr("class", "bar")
//     .attr("x", function(d) { return x(d.letter); })
//     .attr("width", x.rangeBand())
//     .attr("y", function(d) { return y(d.frequency); })
//     .attr("height", function(d) { return height - y(d.frequency); });

// function type(d) {
//   d.frequency = +d.frequency;
//   return d;
// };


// add gridlines
svg.append("g")         
        .attr("class", "grid")
        .attr("transform", "translate(0," + height + ")")
        .call(make_x_axis()
            .tickSize(-height, 0, 0)
            .tickFormat("")
        );
svg.append("g")         
    .attr("class", "grid")
    .call(make_y_axis()
        .tickSize(-width, 0, 0)
        .tickFormat("")
    );


</script>

<h2><center> Steven Rea </center></h2>

<a href="https://github.com/srea64/msan622/blob/gh-pages/hw/homework1.html">See code on github.</a>

<h3> What I Did </h3>

 
<h4> C Level </h4>
<h5>
<br>    1. 
<br>      changed number of decimal points visible to 0
<br>      made frequency dynamic
<br>      changed outer tick size (to 10)
<br>      changed outer tick padding (to 10)
<br>    2. 
<br>      added grid lines
<br>      changed color of grid lines to light blue
<br>      changed axis font size (to 15)
<br>      removed word 'frequency' from y axis
<br>      changed color of axis line to light blue
</h5>

<h4> B Level </h4>
<h5>
<br>    2. Add a button that allows you to change between sorting alphabetically and sorting by value.
<br>    3. Add a tooltip that shows the exact value of a bar when hovering over it.
</h5>

<h3>ToDo</h3>
<h4> C Level </h4>
<h5>
<br>    3. Modify the bar colors (e.g. color vowels differently from consonants).
<br>    4. Modify the sort order (e.g. sort alphabetically vs sort by value). <== overridden by B Level 2. Functionality
      <br>included checkbox to alter sort order
        <br>allows alphabetic or sort by value
</h5>

<h4> B Level </h4>
<h5>
<br>    1. Show a grid line at the mouse y-position (behind the bars) when mouse is hovered over plot area, and show exact value for that line.
<br>    4. Figure out how to add a search box on the page, and show the word count for the text in that box instead of from the URL query string.
<br>
<br>    You need to make at least 4 distinct changes from at least 2 different categories from above to satisfy these requirements. From there, the number and type of changes will influence whether you earn a C-, C, or C+ grade.
<br>    Note: One of the tutorials provides code to change the color of the bar when the mouse hovers over it. This does NOT count towards this category, since it was provided to you.
</h5>

<h4> A Level </h4>
<h5>
<br>    Customize the transitions used in your visualization. For example, you could choose one or more of the following:
<br>
<br>    1. At the start of your visualization, show one bar at a time and smoothly grow each bar from the bottom up to its value.
<br>    2. Allow the user to continue adding new text via a search box and button combo, and use transitions to smoothly update the values. (You will likely need to update your y-axis scale as well if you have a new max value.)
<br>    3. Smoothly fade in the axis line, tick labels, and grid lines for the y-axis only when your plot area is hovered over by the mouse, and smoothly fade out that information when the plot area is no longer hovered over by the mouse.
<br>
<br>    Note: One of the tutorials provides code to change the color of the bar when the mouse hovers over it. This does NOT count towards this category, since it was provided to you.
<br>
<br>    You must complete this functionality to earn a A-level grade (A-, A, or A+) on this assignment.
</h5>

</body>
